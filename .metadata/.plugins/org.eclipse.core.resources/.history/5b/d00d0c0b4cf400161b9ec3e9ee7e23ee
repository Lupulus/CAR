package Command;

import java.io.File;
import java.io.IOException;
import java.io.UncheckedIOException;
import java.nio.file.DirectoryNotEmptyException;
import java.nio.file.Files;
import java.nio.file.NoSuchFileException;

import Request.FtpRequest;

public class CommandDele extends Command{
	
	public CommandDele(FtpRequest ftp){
		super(ftp);
	}
	
	@Override 
	public boolean process(String arg){
		
		File target;
		
		try {
			if (arg.startsWith("/"))
				target =  new File(ftp.getCurrentDirectory().getAbsolutePath(), arg.substring(1)).getCanonicalFile();
			else 
				target = new File(ftp.getCurrentDirectory().getCanonicalPath(), arg).getCanonicalFile();
		} catch (IOException e) {
			throw new UncheckedIOException(e);
		}
			
			try {
				if (target.equals(ftp.getHomeDirectory().getCanonicalPath())) {
					getAnswer().setSpecificMessage("Can't remove root directory");
					send(getAnswer().getAnswers().get("550"));
					return false;
				}
			} catch (IOException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			
			try {
			    Files.delete(target.toPath());
				getAnswer().setSpecificMessage("File deleted successfully");
			    send(getAnswer().getAnswers().get(250));
			    return true;
			} catch (NoSuchFileException e) {
				getAnswer().setSpecificMessage("File not found");
				send(getAnswer().getAnswers().get(550));
				return false;
			} catch (DirectoryNotEmptyException e) {
				getAnswer().setSpecificMessage("Directory not empty");
				send(getAnswer().getAnswers().get(550));
				return false;
			} catch (IOException e) {
				getAnswer().setSpecificMessage("Can't remove file: "+e.getMessage());
				send(getAnswer().getAnswers().get(550));
				return false;
			}
			
	}
}
