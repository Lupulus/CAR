package Command;

import java.io.IOException;
import java.net.InetAddress;
import java.net.Socket;
import java.net.UnknownHostException;
import java.util.Arrays;
import java.util.stream.Collectors;

import Request.FtpRequest;

public class CommandPort extends Command{
	
	public CommandPort(FtpRequest ftp, String arg){
		super(ftp);
		try {
			process(arg);
		} catch (NumberFormatException | IOException e) {
			e.printStackTrace();
		}
	}
	
	@Override
	public void process(String arg){
		Integer[] infos = Arrays.stream(arg.split(","))
				.map(Integer::parseInt)
				.toArray(Integer[]::new);
		
		String host = Arrays.stream(infos, 0, 4)
				.map(e -> e.toString())
				.collect(Collectors.joining("."));
		int port = infos[4] * 256 + infos[5];
		
		try {
			ftp.getRequest().setSocket(new Socket(InetAddress.getByName(host),port));
		} catch (UnknownHostException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
	}
}
//serverSocket sur port 0 new ServerSocket(0) --> le crée aléatoirement

//ici on récup IP et port puis on crée une socket pour